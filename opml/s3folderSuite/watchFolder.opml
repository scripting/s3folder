<?xml version="1.0" encoding="ISO-8859-1"?>
<!-- OPML generated by OPML Editor v11.0.6 on Thu, 17 Oct 2013 20:06:10 GMT -->
<opml version="2.0">
	<head>
		<title>s3folderSuite.watchFolder</title>
		<dateCreated>Mon, 14 Oct 2013 18:50:38 GMT</dateCreated>
		<dateModified>Thu, 17 Oct 2013 20:06:10 GMT</dateModified>
		<ownerName>Dave Winer</ownerName>
		<ownerEmail>dave.winer@gmail.com</ownerEmail>
		<expansionState>1, 2, 3, 6, 11, 13, 14, 18, 30, 32, 34, 40</expansionState>
		<vertScrollState>1</vertScrollState>
		<windowTop>97</windowTop>
		<windowLeft>1132</windowLeft>
		<windowBottom>878</windowBottom>
		<windowRight>2190</windowRight>
		</head>
	<body>
		<outline text="on watchFolder ()">
			<outline text="Changes" isComment="true">
				<outline text="10/14/13; 2:50:44 PM by DW">
					<outline text="Created."/>
					</outline>
				</outline>
			<outline text="local (adrdata = s3folderSuite.init ()) "/>
			<outline text="if adrdata^.prefs.enabled">
				<outline text="local (folder = adrdata^.prefs.folder, f, adrfile, mod, startticks = clock.ticks ())"/>
				<outline text="adrdata^.stats.ctChecks++"/>
				<outline text="adrdata^.stats.whenLastCheck = clock.now ()"/>
				<outline text="file.surefilepath (folder + &quot;xxx&quot;)"/>
				<outline text="for adrfile in @adrdata^.stats.files">
					<outline text="adrfile^.flag = true"/>
					</outline>
				<outline text="fileloop (f in folder, infinity)">
					<outline text="if not (file.filefrompath (f) beginswith &quot;.&quot;)">
						<outline text="adrfile = s3folderSuite.initFile (f)"/>
						<outline text="mod = file.modified (f) "/>
						<outline text="adrfile^.ctChecks++"/>
						<outline text="if mod &gt; adrfile^.whenLastModified">
							<outline text="local (now = clock.now ())"/>
							<outline text="msg (&quot;Uploading &quot; + adrfile^.path + &quot;.&quot;)"/>
							<outline text="s3.newobject (adrdata^.prefs.s3path + adrfile^.s3path, file.readwholefile (f))"/>
							<outline text="adrfile^.whenLastModified = mod"/>
							<outline text="adrfile^.ctUploads++"/>
							<outline text="adrfile^.whenLastUpload = now"/>
							<outline text="adrdata^.stats.ctUploads++"/>
							<outline text="adrdata^.stats.whenLastUpload = now"/>
							<outline text="adrfile^.flag = true"/>
							<outline text="msg (&quot;&quot;)"/>
							</outline>
						<outline text="delete (@adrfile^.flag)"/>
						</outline>
					</outline>
				<outline text="bundle //delete all files with the flag still present">
					<outline text="local (i, adrfile)"/>
					<outline text="for i = sizeof (adrdata^.stats.files) downto 1">
						<outline text="adrfile = @adrdata^.stats.files [i]"/>
						<outline text="if defined (adrfile^.flag)">
							<outline text="msg (&quot;Deleting &quot; + adrfile^.path + &quot;.&quot;)"/>
							<outline text="try {s3.deleteobject (adrdata^.prefs.s3path + adrfile^.s3path)}"/>
							<outline text="delete (adrfile)"/>
							<outline text="msg (&quot;&quot;)"/>
							</outline>
						</outline>
					</outline>
				<outline text="adrdata^.stats.ctTicksLastWatch = clock.ticks () - startticks"/>
				</outline>
			</outline>
		<outline text="bundle //test code">
			<outline text="watchFolder ()"/>
			</outline>
		</body>
	</opml>
